<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="Multipurpose multilanguage Discord bot with many features for your Discord server. View your custom branded bots here.">
		<meta name="theme-color" content="#ed8721">

		<link rel="alternate" hreflang="de-DE" href="https://tomatenkuchen.eu/dashboard/custom/">
		<link rel="canonical" href="https://tomatenkuchen.eu/dashboard/custom/">
		<link rel="manifest" href="../../manifest.json">

		<title>TomatenKuchen - Custom branded bots - Dashboard</title>
		<link href="../../assets/images/favicon.ico" rel="shortcut icon" type="image/x-icon">
		<link href="../../assets/images/apple-icon-120.png" rel="apple-touch-icon" sizes="120x120">
		<link href="../../assets/images/apple-icon-152.png" rel="apple-touch-icon" sizes="152x152">

		<link href="../../assets/style.css" rel="stylesheet" type="text/css">

		<link rel="preconnect" href="https://api.tomatenkuchen.eu">
		<link rel="dns-prefetch" href="https://api.tomatenkuchen.eu">

		<script src="../../assets/js/script.js"></script>
		<script src="../../assets/js/language.js"></script>

		<script src="../../assets/js/api/api.js"></script>
		<script src="../../assets/js/api/transformer_dashboard.js"></script>
	</head>
	<body class="dark-theme" onload="pageLoad()">
		<global-sidebar page="dashboard"></global-sidebar>

		<main class="main" id="main">
			<header class="top">
				<div class="hamburger" onclick="sidebar()">
					<div class="line" id="lineTop1"></div>
					<div class="line" id="lineBottom1"></div>
				</div>

				<div class="hoverdropdown">
					<div class="account" onclick="location='/login'">
						<p id="username-header" translation="global.account">Account</p>
						<ion-icon id="username-avatar" name="person-circle-outline"></ion-icon>
					</div>
					<div class="hoverdropdown-content">
						<a href="/login" translation="global.login"></a>
					</div>
				</div>
			</header>

			<div class="content" id="content">
				<div id="create-dialog" class="dialog">
					<div class="dialog-content">
						<span class="close">&times;</span>
						<h1>Create a new custom branded bot</h1>

						<label for="custom-token">Your bot token</label>
						<input type="text" minlength="45" maxlength="90" pattern="[a-z0-9_\-]+" placeholder="Bot token from Discord" onchange="tokenChange(this)" name="custom-token" id="custom-token">
						<br>

						<div id="bot-data" hidden>
							<div class="flex">
								<img id="bot-avatar" width="128" height="128" alt="Bot avatar">
								<div>
									<h2 id="bot-name"></h2>
									<p id="bot-access"></p>
								</div>
							</div>

							<label for="custom-invite">Invite users to "pay" for the bot</label>
							<input placeholder="User IDs separated by ," name="custom-invite" id="custom-invite">
						</div>

						<button type="submit" id="bot-create" class="createForm green" onclick="createCustom()" disabled>Register bot</button>
					</div>
				</div>

				<div id="root-container" class="row">
					<h1>Loading your custom branded bots...</h1>
				</div>
			</div>
		</main>

		<script>
			async function tokenChange() {
				document.getElementById("bot-data").setAttribute("hidden", "");
				document.getElementById("bot-create").setAttribute("disabled", "");

				const elem = document.getElementById("custom-token");
				const value = elem.value;
				if (!value || value.length < 45 || value.length > 90 || value.split(".").length != 3) return elem.setCustomValidity("Invalid bot token format.");

				const info = await getCustomInfo(value);
				if (info.status == "success") {
					document.getElementById("bot-data").removeAttribute("hidden");
					document.getElementById("bot-create").removeAttribute("disabled");

					document.getElementById("bot-name").src = encode(info.username);
					document.getElementById("bot-avatar").src = encode(info.avatar);
					document.getElementById("bot-access").src = "Users with access:<br><ul>" + info.access.map(user => "<li>" + encode(user) + "</li>").join("") + "</ul>";
				} else elem.setCustomValidity("Invalid bot token.");
			}

			if (getCookie("token"))
				getCustomHTML().then(data => {
					document.getElementById("root-container").innerHTML = data;
					reloadText();
				});
			else {
				document.getElementById("root-container").innerHTML = "<h1>Redirecting to login...</h1>";
				location.href = "../../login/?next=" + encodeURIComponent(location.pathname + location.search);
			}
		</script>

		<global-footer></global-footer>
		<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js" integrity="sha384-xyQ/Vpt1cq1pdPYlRaT/QkcSj2vrYyWI3WOhxGBzqnP1vgvsS2yrhWXe3/wIoCr5" crossorigin="anonymous"></script>
	</body>
</html>
