<!DOCTYPE html>
<html lang="de">
<head>
  <title>TomatenKuchen - Dashboard</title>

  <link rel="shortcut icon" type="image/x-icon" href="../assets/icon.ico"/>
  <link rel="icon" type="image/x-icon" href="../assets/icon.ico"/>

  <link rel="stylesheet" type="text/css" href="../assets/css/fullframe.css"/>

  <script src="../assets/js/cookie.js"></script>
  <script src="../assets/js/authentication.js"></script>
  <script>authRedirect();</script>
</head>

<body>
<script>
  const params = new URLSearchParams(window.location.search);

  if (!getCookie('access_token') && getCookie('code')) {
    let params = '?code=' + encodeURIComponent(getCookie('code'));
    if (getCookie('guild_id')) params += '&guild_id=' + encodeURIComponent(getCookie('guild_id'))
    if (getCookie('permissions')) params += '&permissions=' + encodeURIComponent(getCookie('permissions'));

    document.body.innerHTML = '<iframe src="http://136.243.92.96:7025/login' + params + '"></iframe>';
    setCookie('access_token', getCookie('code'), 7);
  } else if (getCookie('access_token') && params.has('guild')) {
    document.body.innerText = '<iframe src="http://136.243.92.96:7025/guild/"' + encodeURIComponent(params.get('guild')) + '></iframe>'
  } else if (getCookie('access_token')) {
    document.body.innerText = '<iframe src="http://136.243.92.96:7025/guilds"></iframe>'
  } else {
    document.body.innerText = '<h1>Redirecting...</h1>';
  }
</script>
</body>
</html>
